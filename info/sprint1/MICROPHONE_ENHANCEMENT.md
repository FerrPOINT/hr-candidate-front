# Система усиления микрофона для улучшения транскрибации

## Обзор

Система усиления микрофона в приложении HR Recruiter разработана для максимального улучшения качества записи речи и, как следствие, точности транскрибации. Система использует современные веб-аудио технологии для обработки звука в реальном времени.

## Архитектура системы

### 1. Аудио цепочка обработки

```
Microphone → High-pass Filter → Notch Filter → Compressor → Gain Node → Low-pass Filter → Analyzer → MediaRecorder
```

#### Компоненты:

**High-pass Filter (80Hz)**
- Убирает низкочастотные помехи (гул, вибрации)
- Улучшает четкость речи
- Настройки: frequency = 80Hz, Q = 1.0

**Notch Filter (50Hz)**
- Убирает сетевые помехи (50Hz в Европе, 60Hz в США)
- Критически важно для качественной записи
- Настройки: frequency = 50Hz, Q = 10.0

**Dynamics Compressor**
- Улучшает динамический диапазон
- Делает тихие звуки громче, громкие - тише
- Настройки: threshold = -24dB, ratio = 4:1, attack = 3ms, release = 250ms

**Gain Node**
- Автоматическое усиление микрофона
- Диапазон: 1.0x - 5.0x
- Динамическая настройка на основе уровня звука

**Low-pass Filter (8kHz)**
- Убирает высокочастотные шумы
- Оптимизирует для речевых частот
- Настройки: frequency = 8000Hz, Q = 1.0

### 2. Динамическое усиление

Система автоматически настраивает усиление на основе текущего уровня звука:

```javascript
// Алгоритм динамического усиления
if (currentLevel < targetLevel * 0.5) {
  // Слишком тихо - увеличиваем усиление
  newGain = Math.min(maxGain, currentGain * 1.2);
} else if (currentLevel > targetLevel * 1.5) {
  // Слишком громко - уменьшаем усиление
  newGain = Math.max(minGain, currentGain * 0.8);
}
```

### 3. Анализ качества в реальном времени

Система анализирует качество записи и предоставляет обратную связь:

- **Отлично** (зеленый): Уровень звука > 30%
- **Хорошо** (желтый): Уровень звука 10-30%
- **Плохо** (красный): Уровень звука < 10%

## Технические характеристики

### Настройки записи
- **Частота дискретизации**: 48kHz (высокое качество)
- **Каналы**: Моно (оптимально для речи)
- **Кодек**: WebM/Opus (лучший для речи)
- **Битрейт**: Автоматический (обычно 64-128 kbps)

### Производительность
- **Задержка**: < 10ms
- **Использование CPU**: < 5%
- **Память**: < 10MB

## Конфигурация

### Основные параметры

```javascript
const AUDIO_ENHANCEMENT_CONFIG = {
  gain: {
    value: 2.0,        // Начальное усиление
    minValue: 1.0,     // Минимальное усиление
    maxValue: 5.0      // Максимальное усиление
  },
  compression: {
    threshold: -24,    // Порог компрессии (dB)
    ratio: 4,          // Коэффициент компрессии
    attack: 0.003,     // Время атаки (секунды)
    release: 0.25      // Время восстановления (секунды)
  },
  filtering: {
    lowPass: 8000,     // Верхняя частота среза (Hz)
    highPass: 80,      // Нижняя частота среза (Hz)
    notch: 50          // Частота подавления (Hz)
  }
};
```

### Настройка для разных условий

#### Тихая среда
```javascript
gain: { value: 1.5, maxValue: 3.0 }
compression: { threshold: -30, ratio: 2 }
```

#### Шумная среда
```javascript
gain: { value: 3.0, maxValue: 5.0 }
compression: { threshold: -20, ratio: 6 }
filtering: { lowPass: 6000, highPass: 100 }
```

## Мониторинг и диагностика

### Логирование
Система ведет подробные логи для диагностики:
- Уровень усиления в реальном времени
- Качество записи
- Размер аудио файлов
- Ошибки обработки

### Метрики качества
- Средний уровень звука
- Динамический диапазон
- Частотный спектр
- Соотношение сигнал/шум

## Совместимость

### Поддерживаемые браузеры
- Chrome 66+ (полная поддержка)
- Firefox 60+ (полная поддержка)
- Safari 14+ (частичная поддержка)
- Edge 79+ (полная поддержка)

### Требования к оборудованию
- Микрофон (встроенный или внешний)
- Поддержка Web Audio API
- Минимум 2GB RAM
- Процессор с поддержкой SSE2

## Устранение неполадок

### Частые проблемы

1. **Низкий уровень звука**
   - Проверьте настройки микрофона в системе
   - Убедитесь, что выбран правильный микрофон
   - Проверьте разрешения браузера

2. **Искажения звука**
   - Уменьшите усиление
   - Проверьте качество микрофона
   - Убедитесь в отсутствии электромагнитных помех

3. **Задержки записи**
   - Закройте другие приложения
   - Проверьте загрузку CPU
   - Обновите браузер

### Диагностические команды

```javascript
// Проверка поддержки Web Audio API
if (typeof AudioContext !== 'undefined') {
  console.log('Web Audio API поддерживается');
}

// Проверка доступных аудио устройств
navigator.mediaDevices.enumerateDevices()
  .then(devices => {
    const audioDevices = devices.filter(device => device.kind === 'audioinput');
    console.log('Доступные микрофоны:', audioDevices);
  });
```

## Будущие улучшения

### Планируемые функции
- Адаптивное шумоподавление
- Распознавание речи в реальном времени
- Автоматическая настройка под тип микрофона
- Поддержка стерео записи
- Интеграция с внешними аудио процессорами

### Оптимизации
- WebAssembly для обработки аудио
- Web Workers для фоновой обработки
- Кэширование настроек пользователя
- Предварительная загрузка аудио компонентов 